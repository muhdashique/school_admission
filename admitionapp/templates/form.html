{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title|default:"Student Admission Form" }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .required-field::after {
            content: "*";
            color: red;
            margin-left: 4px;
        }
        .form-label {
            font-weight: 500;
        }
        .errorlist {
            color: #dc3545;
            list-style-type: none;
            padding-left: 0;
            font-size: 0.875rem;
        }
        .photo-preview {
            width: 150px;
            height: 150px;
            border: 1px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1>Student Admission Form</h1>
            <p class="text-muted">Please fill in the details below</p>
        </div>
        <div>
            {% if registered_number %}
            <h2 class="text-center">Welcome, Registered Number: {{ registered_number }}</h2>
            {% endif %}
        </div>
        <!-- Alerts for messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        
        <form method="post" enctype="multipart/form-data" class="needs-validation" action="{% url 'admission_form' %}" novalidate>
            {% csrf_token %}
            
            <!-- Student Information Section -->
            <div class="form-section">
                <h3 class="mb-3">Student Information</h3>
                <div class="row g-3">
                    <!-- Name field -->
                    <div class="col-md-6">
                        <label for="{{ student_form.name.id_for_label }}" class="form-label required-field">Full Name</label>
                        {{ student_form.name }}
                        {% if student_form.name.errors %}
                            <div class="errorlist">
                                {{ student_form.name.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Standard/Class field -->
                    <div class="col-md-6">
                        <label for="{{ student_form.standard.id_for_label }}" class="form-label required-field">Class/Standard</label>
                        {{ student_form.standard }}
                        {% if student_form.standard.errors %}
                            <div class="errorlist">
                                {{ student_form.standard.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Date of Birth field -->
                    <div class="col-md-4">
                        <label for="{{ student_form.dob.id_for_label }}" class="form-label required-field">Date of Birth</label>
                        {{ student_form.dob }}
                        {% if student_form.dob.errors %}
                            <div class="errorlist">
                                {{ student_form.dob.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Age field -->
                    <div class="col-md-4">
                        <label for="{{ student_form.age.id_for_label }}" class="form-label">Age</label>
                        {{ student_form.age }}
                        {% if student_form.age.errors %}
                            <div class="errorlist">
                                {{ student_form.age.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Sex/Gender field -->
                    <div class="col-md-4">
                        <label for="{{ student_form.sex.id_for_label }}" class="form-label required-field">Gender</label>
                        {{ student_form.sex }}
                        {% if student_form.sex.errors %}
                            <div class="errorlist">
                                {{ student_form.sex.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mobile field -->
                    <div class="col-md-6">
                        <label for="{{ student_form.mobile.id_for_label }}" class="form-label required-field">Mobile Number</label>
                        {{ student_form.mobile }}
                        <small class="form-text text-muted">10 digit number without country code</small>
                        {% if student_form.mobile.errors %}
                            <div class="errorlist">
                                {{ student_form.mobile.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Blood group field -->
                    <div class="col-md-6">
                        <label for="{{ student_form.blood_group.id_for_label }}" class="form-label">Blood Group</label>
                        {{ student_form.blood_group }}
                        {% if student_form.blood_group.errors %}
                            <div class="errorlist">
                                {{ student_form.blood_group.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Address field -->
                    <div class="col-12">
                        <label for="{{ student_form.address.id_for_label }}" class="form-label required-field">Address</label>
                        {{ student_form.address }}
                        {% if student_form.address.errors %}
                            <div class="errorlist">
                                {{ student_form.address.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Nationality field -->
                    <div class="col-md-4">
                        <label for="{{ student_form.nationality.id_for_label }}" class="form-label required-field">Nationality</label>
                        {{ student_form.nationality }}
                        {% if student_form.nationality.errors %}
                            <div class="errorlist">
                                {{ student_form.nationality.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mother Tongue field -->
                    <div class="col-md-4">
                        <label for="{{ student_form.mother_tongue.id_for_label }}" class="form-label">Mother Tongue</label>
                        {{ student_form.mother_tongue }}
                        {% if student_form.mother_tongue.errors %}
                            <div class="errorlist">
                                {{ student_form.mother_tongue.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Religion field -->
                    <div class="col-md-4">
                        <label for="{{ student_form.religion.id_for_label }}" class="form-label">Religion</label>
                        {{ student_form.religion }}
                        {% if student_form.religion.errors %}
                            <div class="errorlist">
                                {{ student_form.religion.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Caste field -->
                    <div class="col-md-4">
                        <label for="{{ student_form.caste.id_for_label }}" class="form-label">Caste</label>
                        {{ student_form.caste }}
                        {% if student_form.caste.errors %}
                            <div class="errorlist">
                                {{ student_form.caste.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Identification Mark field -->
                    <div class="col-md-8">
                        <label for="{{ student_form.id_mark.id_for_label }}" class="form-label">Identification Mark</label>
                        {{ student_form.id_mark }}
                        {% if student_form.id_mark.errors %}
                            <div class="errorlist">
                                {{ student_form.id_mark.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Student Photo field -->
                    <div class="col-md-12">
                        <label for="{{ student_form.student_photo.id_for_label }}" class="form-label">Student Photo</label>
                        <div class="photo-preview" id="studentPhotoPreview">
                            <span>Photo Preview</span>
                        </div>
                        {{ student_form.student_photo }}
                        {% if student_form.student_photo.errors %}
                            <div class="errorlist">
                                {{ student_form.student_photo.errors }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Parent Information Section -->
            <div class="form-section">
                <h3 class="mb-3">Parent Information</h3>
                
                <!-- Father's Details -->
                <h5 class="mb-3">Father's Details</h5>
                <div class="row g-3">
                    <!-- Father's Name field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.father_name.id_for_label }}" class="form-label required-field">Father's Name</label>
                        {{ parent_form.father_name }}
                        {% if parent_form.father_name.errors %}
                            <div class="errorlist">
                                {{ parent_form.father_name.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Father's Occupation field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.father_job.id_for_label }}" class="form-label">Occupation</label>
                        {{ parent_form.father_job }}
                        {% if parent_form.father_job.errors %}
                            <div class="errorlist">
                                {{ parent_form.father_job.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Father's Mobile field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.father_mobile.id_for_label }}" class="form-label required-field">Mobile Number</label>
                        {{ parent_form.father_mobile }}
                        {% if parent_form.father_mobile.errors %}
                            <div class="errorlist">
                                {{ parent_form.father_mobile.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Father's Email field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.father_email.id_for_label }}" class="form-label">Email</label>
                        {{ parent_form.father_email }}
                        {% if parent_form.father_email.errors %}
                            <div class="errorlist">
                                {{ parent_form.father_email.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Father's Education field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.father_education.id_for_label }}" class="form-label">Education</label>
                        {{ parent_form.father_education }}
                        {% if parent_form.father_education.errors %}
                            <div class="errorlist">
                                {{ parent_form.father_education.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Father's Place field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.father_place.id_for_label }}" class="form-label">Native Place</label>
                        {{ parent_form.father_place }}
                        {% if parent_form.father_place.errors %}
                            <div class="errorlist">
                                {{ parent_form.father_place.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Father's Photo field -->
                    <div class="col-md-12">
                        <label for="{{ parent_form.father_photo.id_for_label }}" class="form-label">Father's Photo</label>
                        <div class="photo-preview" id="fatherPhotoPreview">
                            <span>Photo Preview</span>
                        </div>
                        {{ parent_form.father_photo }}
                        {% if parent_form.father_photo.errors %}
                            <div class="errorlist">
                                {{ parent_form.father_photo.errors }}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Mother's Details -->
                <h5 class="mt-4 mb-3">Mother's Details</h5>
                <div class="row g-3">
                    <!-- Mother's Name field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.mother_name.id_for_label }}" class="form-label required-field">Mother's Name</label>
                        {{ parent_form.mother_name }}
                        {% if parent_form.mother_name.errors %}
                            <div class="errorlist">
                                {{ parent_form.mother_name.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mother's Occupation field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.mother_job.id_for_label }}" class="form-label">Occupation</label>
                        {{ parent_form.mother_job }}
                        {% if parent_form.mother_job.errors %}
                            <div class="errorlist">
                                {{ parent_form.mother_job.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mother's Mobile field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.mother_mobile.id_for_label }}" class="form-label required-field">Mobile Number</label>
                        {{ parent_form.mother_mobile }}
                        {% if parent_form.mother_mobile.errors %}
                            <div class="errorlist">
                                {{ parent_form.mother_mobile.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mother's Email field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.mother_email.id_for_label }}" class="form-label">Email</label>
                        {{ parent_form.mother_email }}
                        {% if parent_form.mother_email.errors %}
                            <div class="errorlist">
                                {{ parent_form.mother_email.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mother's Education field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.mother_education.id_for_label }}" class="form-label">Education</label>
                        {{ parent_form.mother_education }}
                        {% if parent_form.mother_education.errors %}
                            <div class="errorlist">
                                {{ parent_form.mother_education.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mother's Place field -->
                    <div class="col-md-6">
                        <label for="{{ parent_form.mother_place.id_for_label }}" class="form-label">Native Place</label>
                        {{ parent_form.mother_place }}
                        {% if parent_form.mother_place.errors %}
                            <div class="errorlist">
                                {{ parent_form.mother_place.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mother's Photo field -->
                    <div class="col-md-12">
                        <label for="{{ parent_form.mother_photo.id_for_label }}" class="form-label">Mother's Photo</label>
                        <div class="photo-preview" id="motherPhotoPreview">
                            <span>Photo Preview</span>
                        </div>
                        {{ parent_form.mother_photo }}
                        {% if parent_form.mother_photo.errors %}
                            <div class="errorlist">
                                {{ parent_form.mother_photo.errors }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Submit button -->
            <div class="text-center my-4">
                <button type="submit" class="btn btn-primary btn-lg px-5">Submit Application</button>
            </div>
        </form>
    </div>



    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            background-color: #f8f9fa;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .action-link {
            color: #0066cc;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Display logged in number -->
        <div class="header">
            {% if registered_number %}
            <strong>Logged in with:</strong> {{ registered_number }}
            {% endif %}
        </div>
    
        <!-- Only show students table -->
        {% if students %}
        <h2>Your Registered Students</h2>
        <div class="table-responsive">
            <table class="table table-bordered table-hover text-center">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Student Photo</th>
                        <th>Name</th>
                        <th>Standard</th>
                        <th>DOB</th>
                        <th>Age</th>
                        <th>Sex</th>
                        <th>Address</th>
                        <th>Nationality</th>
                        <th>Mobile</th>
                        <th>Mother Tongue</th>
                        <th>Religion</th>
                        <th>Caste</th>
                        <th>Blood Group</th>
                        <th>Identification Mark</th>
                        <th>Father's Photo</th>
                        <th>Father's Name</th>
                        <th>Father's Job</th>
                        <th>Father's Education</th>
                        <th>Father's Mobile</th>
                        <th>Father's Email</th>
                        <th>Father's Place</th>
                        <th>Mother's Photo</th>
                        <th>Mother's Name</th>
                        <th>Mother's Job</th>
                        <th>Mother's Education</th>
                        <th>Mother's Mobile</th>
                        <th>Mother's Email</th>
                        <th>Mother's Place</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            {% if student.student_photo %}
                                <img src="{{ student.student_photo.url }}" class="img-thumbnail" width="50">
                            {% else %}
                                No Photo
                            {% endif %}
                        </td>
                        <td>{{ student.name }}</td>
                        <td>{{ student.standard }}</td>
                        <td>{{ student.dob }}</td>
                        <td>{{ student.age }}</td>
                        <td>{{ student.sex }}</td>
                        <td>{{ student.address }}</td>
                        <td>{{ student.nationality }}</td>
                        <td>{{ student.mobile }}</td>
                        <td>{{ student.mother_tongue }}</td>
                        <td>{{ student.religion }}</td>
                        <td>{{ student.caste }}</td>
                        <td>{{ student.blood_group }}</td>
                        <td>{{ student.id_mark }}</td>
                        <td>
                            {% if student.parent.father_photo %}
                                <img src="{{ student.parent.father_photo.url }}" class="img-thumbnail" width="50">
                            {% else %}
                                No Photo
                            {% endif %}
                        </td>
                        <td>{{ student.parent.father_name }}</td>
                        <td>{{ student.parent.father_job }}</td>
                        <td>{{ student.parent.father_education }}</td>
                        <td>{{ student.parent.father_mobile }}</td>
                        <td>{{ student.parent.father_email }}</td>
                        <td>{{ student.parent.father_place }}</td>
                        <td>
                            {% if student.parent.mother_photo %}
                                <img src="{{ student.parent.mother_photo.url }}" class="img-thumbnail" width="50">
                            {% else %}
                                No Photo
                            {% endif %}
                        </td>
                        <td>{{ student.parent.mother_name }}</td>
                        <td>{{ student.parent.mother_job }}</td>
                        <td>{{ student.parent.mother_education }}</td>
                        <td>{{ student.parent.mother_mobile }}</td>
                        <td>{{ student.parent.mother_email }}</td>
                        <td>{{ student.parent.mother_place }}</td>
                        <td>
                            <a href="{% url 'edit_registered_student' student.id %}" class="btn btn-primary btn-sm">Edit</a>
                            <a href="{% url 'student_delete' student.id %}" onclick="return confirm('Are you sure you want to delete this student?')" class="btn btn-danger">Delete</a>
                        </td>
                        
                        
                        
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No registered students found for this account.</p>
        {% endif %}
    </div>
    
    

        
    



    <!-- Bootstrap JS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Form validation and image preview script -->
    <script>
        // Form validation
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        form.classList.add('was-validated')
                    }, false)
                })
        })()
        
        // Image preview functionality
        function setupImagePreview(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            if (input && preview) {
                input.addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%;">`;
                        }
                        reader.readAsDataURL(this.files[0]);
                    } else {
                        preview.innerHTML = `<span>Photo Preview</span>`;
                    }
                });
            }
        }
        
        // Setup preview for all photo inputs
        document.addEventListener('DOMContentLoaded', function() {
            setupImagePreview('{{ student_form.student_photo.auto_id }}', 'studentPhotoPreview');
            setupImagePreview('{{ parent_form.father_photo.auto_id }}', 'fatherPhotoPreview');
            setupImagePreview('{{ parent_form.mother_photo.auto_id }}', 'motherPhotoPreview');
            
            // Calculate age based on DOB
            const dobInput = document.getElementById('{{ student_form.dob.auto_id }}');
            const ageInput = document.getElementById('{{ student_form.age.auto_id }}');
            
            if (dobInput && ageInput) {
                dobInput.addEventListener('change', function() {
                    if (this.value) {
                        const dob = new Date(this.value);
                        const today = new Date();
                        let age = today.getFullYear() - dob.getFullYear();
                        const monthDiff = today.getMonth() - dob.getMonth();
                        
                        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                            age--;
                        }
                        
                        ageInput.value = age;
                    }
                });
            }
        });
    </script>
</body>
</html>